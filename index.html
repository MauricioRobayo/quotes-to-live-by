<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quotes to Live By</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        margin: 0;
        background-color: hsl(24, 100%, 50%);
        font-family: "Montserrat", sans-serif;
        min-height: 100vh;
        text-align: center;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }
      figure {
        margin: 2rem 0;
        display: flex;
        justify-content: center;
        flex-direction: column;
        flex: 1;
      }
      blockquote {
        margin: 0 auto 2rem;
        cursor: pointer;
        font-weight: 900;
        font-size: clamp(2rem, 8vw, 4rem);
        color: white;
        max-width: min(1400px, 90%);
      }
      figcaption {
        font-weight: 700;
        color: hsl(0, 0%, 20%);
        font-size: clamp(1rem, 4vw, 2rem);
      }
      figcaption::after, figcaption::before {
        content: "ã€°";
        margin: 0.5rem;
      }
      header {
        cursor: pointer;
      }
      footer,
      header {
        font-size: 0.85rem;
        padding: 1rem;
        color: hsl(0, 0%, 20%);
        text-transform: uppercase;
      }
      footer a {
        color: inherit;
        text-decoration: none;
        padding: 0.5rem;
      }
      footer a:hover {
        text-decoration: underline wavy currentColor;
      }
      /* loader https://loading.io/css/ */
      .lds-ripple {
        display: inline-block;
        position: relative;
        width: 80px;
        height: 80px;
      }
      .lds-ripple div {
        position: absolute;
        border: 4px solid #fff;
        opacity: 1;
        border-radius: 50%;
        animation: lds-ripple 1s cubic-bezier(0, 0.2, 0.8, 1) infinite;
      }
      .lds-ripple div:nth-child(2) {
        animation-delay: -0.5s;
      }
      @keyframes lds-ripple {
        0% {
          top: 36px;
          left: 36px;
          width: 0;
          height: 0;
          opacity: 1;
        }
        100% {
          top: 0px;
          left: 0px;
          width: 72px;
          height: 72px;
          opacity: 0;
        }
      }
      /* end loader */
    </style>
  </head>
  <body>
    <header>
      New quote
    </header>
    <figure>
      <div id="loader" class="lds-ripple">
        <div></div>
        <div></div>
      </div>
    </figure>
    <footer>
      <a href="https://github.com/MauricioRobayo/quotes-to-live-by"
        >Source code</a
      >
    </footer>
    <script>
      (function () {
        function createElement(type, textContent) {
          const el = document.createElement(type);
          el.textContent = textContent;
          return el;
        }

        async function getQuotes() {
          const SESSION_STORAGE_KEY = "quotes";

          const sessionStorageQuotes = sessionStorage.getItem(
            SESSION_STORAGE_KEY
          );
          if (sessionStorageQuotes) {
            return JSON.parse(sessionStorageQuotes);
          }

          const response = await fetch(
            "https://raw.githubusercontent.com/MauricioRobayo/quotes-to-live-by/master/quotes-to-live-by.json"
          );
          if (!response.ok) {
            throw new Error(
              `Error fetching quotes: ${response.status} ${response.statusText}`
            );
          }
          const quotes = await response.json();

          sessionStorage.setItem(SESSION_STORAGE_KEY, JSON.stringify(quotes));

          return quotes;
        }

        function shuffle(quotes) {
          return quotes.sort(() => Math.random() - 0.5);
        }

        function render(container, ...children) {
          container.innerHTML = "";
          container.append(...children);
        }

        function renderQuote(container, { quote, author = "", cite = "" }) {
          const blockquote = createElement("blockquote", quote);

          if (cite.trim()) {
            blockquote.setAttribute("cite", cite);
          }

          if (author.trim()) {
            const footer = createElement("figcaption", author);
            render(container, blockquote, footer);
          } else {
            render(container, blockquote);
          }
        }

        function renderError(container, error) {
          render(container, createElement("div", error));
        }

        function loadQuotes() {
          const container = document.querySelector("figure");
          getQuotes()
            .then((quotes) => {
              renderQuote(container, shuffle(quotes)[0]);
            })
            .catch((error) => {
              renderError(container, error);
            });
        }

        document.body.addEventListener("click", function (event) {
          if (event.target.matches("blockquote") || event.target.matches('header')) {
            loadQuotes();
          }
        });

        loadQuotes();
      })();
    </script>
  </body>
</html>
